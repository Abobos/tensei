# Resource Plugins

[[toc]]

## Overview

Resource plugins are very similar to [custom plugins](./plugins.md); however, instead of displaying in the Nova sidebar, resource plugins are displayed on a particular resource's detail screen. Like Nova plugins, resource plugins are incredibly customizable, and primarily consist of a single-file Vue component that is totally under your control.

## Defining Plugins

Resource plugins may be generated using the `nova:resource-plugin` Artisan command. By default, all new plugins will be placed in the `nova-components` directory of your application. When generating a plugin using the `nova:resource-plugin` command, the plugin name you pass to the command should follow the Composer `vendor/package` format. So, if we were building a Stripe inspector plugin, we might run the following command:

```bash
php artisan nova:resource-plugin acme/stripe-inspector
```

When generating a plugin, Nova will prompt you to install the plugin's NPM dependencies, compile its assets, and update your application's `composer.json` file. All custom plugins are registered with your application as a Composer "path" repository.

Nova resource plugins include all of the scaffolding necessary to build your plugin. Each plugin even contains its own `composer.json` file and is ready to be shared with the world on GitHub or the source control provider of your choice.

## Registering Plugins

Nova resource plugins may be registered in your resource's `fields` method. This method returns an array of fields available to the resource. To register your resource plugin, add your plugin to the array of fields returned by this method:

```php
use Acme\StripeInspector\StripeInspector;

/**
 * Get the fields displayed by the resource.
 *
 * @param  \Illuminate\Http\Request  $request
 * @return array
 */
public function fields(Request $request)
{
    return [
        ID::make('ID', 'id')->sortable(),

        StripeInspector::make(),
    ];
}
```

### Plugin Options

Often, you will need to allow the consumer's of your plugin to customize run-time configuration options on the plugin. You may do this by exposing methods on your plugin class. These methods may call the plugin's underlying `withMeta` method to add information to the plugin's metadata, which [will be available](#resource-plugin-properties) within your `Plugin.vue` component. The `withMeta` method accepts an array of key / value options:

```php
<?php

namespace Acme\StripeInspector;

use Laravel\Nova\ResourcePlugin;

class StripeInspector extends ResourcePlugin
{
    /**
     * Get the displayable name of the resource plugin.
     *
     * @return string
     */
    public function name()
    {
        return 'Stripe Inspector';
    }

    /**
     * Indicates that the Stripe inspector should allow refunds.
     *
     * @return $this
     */
    public function issuesRefunds()
    {
        return $this->withMeta(['issuesRefunds' => true]);
    }

    /**
     * Get the component name for the resource plugin.
     *
     * @return string
     */
    public function component()
    {
        return 'stripe-inspector';
    }
}
```

## Building Plugins

Each plugin generated by Nova includes its own service provider and "plugin" class. Using the `stripe-inspector` plugin as an example, the plugin class will be located at `src/StripeInspector.php`.

The plugin's service provider is also located within the `src` directory of the plugin, and is registered in your plugin's `composer.json` file so that it will be auto-loaded by the Laravel framework.

### Authorization

If you would like to only expose a given plugin to certain users, you may chain the `canSee` method onto your plugin's registration. The `canSee` method accepts a Closure which should return `true` or `false`. The Closure will receive the incoming HTTP request:

```php
use Acme\StripeInspector\StripeInspector;

/**
 * Get the fields displayed by the resource.
 *
 * @param  \Illuminate\Http\Request  $request
 * @return array
 */
public function fields(Request $request)
{
    return [
        ID::make('ID', 'id')->sortable(),

        StripeInspector::make()->canSee(function ($request) {
            return false;
        }),
    ];
}
```

### Routing

Often, you will need to define Laravel routes that are called by your plugin. When Nova generates your plugin, it creates a `routes/api.php` routes file. If needed, you may use this file to define any routes your plugin requires.

All routes within this file are automatically defined inside a route group by your plugin's `PluginServiceProvider`. The route group specifies that all routes within the group should receive a `/nova-vendor/plugin-name` prefix, where `plugin-name` is the "kebab-case" name of your plugin. So, for example, `/nova-vendor/stripe-inspector`. You are free to modify this route group definition, but take care to make sure your Nova plugin will co-exist with other Nova packages.

:::danger Routing Authorization

When building routes for your plugin, you should **always** add authorization to these routes using Laravel gates or policies.
:::

### Assets

When Nova generates your plugin, `resources/js` and `resources/sass` directories are generated for you. These directories contain your plugin's JavaScript and Sass stylesheets. The primary files of interest in these directories are: `resources/js/components/Plugin.vue` and `resources/sass/plugin.scss`.

The `Plugin.vue` file is a single-file Vue component that contains your plugin's front-end. From this file, you are free to build your plugin however you want. Your plugin can make HTTP requests using Axios, which is available globally. In addition, the `moment.js` and `underscore.js` libraries are globally available.

#### Resource Plugin Properties

Your resource plugin's `Plugin.vue` component receives several Vue `props`: `resourceName`, `resourceId`, and `field`. The `resourceId` property contains the primary key of the resource the plugin is currently attached to. You may use the `resourceId` when making requests to your controllers. The `field` property provides access to any plugin [options](#plugin-options) that may be available:

```js
const issuesRefunds = this.field.issuesRefunds;
```

#### Registering Assets

Your Nova plugin's service provider registers your plugin's compiled assets so that they will be available to the Nova front-end:

```php
/**
 * Bootstrap any application services.
 *
 * @return void
 */
public function boot()
{
    $this->app->booted(function () {
        $this->routes();
    });

    Nova::serving(function (ServingNova $event) {
        Nova::script('stripe-inspector', __DIR__.'/../dist/js/plugin.js');
        Nova::style('stripe-inspector', __DIR__.'/../dist/css/plugin.css');
    });
}
```

:::tip JavaScript Bootstrap & Routing

Your component is bootstrapped and registered in the `resources/js/plugin.js` file. You are free to modify this file or register additional components here as needed.
:::

#### Compiling Assets

Your Nova resource plugin contains a `webpack.mix.js` file, which is generated when Nova creates your plugin. You may build your plugin using the NPM `dev` and `prod` commands:

```bash
// Compile your assets for local development...
npm run dev

// Compile and minify your assets...
npm run prod
```

In addition, you may run the NPM `watch` command to auto-compile your assets when they are changed:

```bash
npm run watch
```
